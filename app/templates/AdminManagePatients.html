<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Patients</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/static/css/admin.css">
  <link rel="shortcut icon" href="{{url_for('static', filename='images/clinic-logo.png')}}"> 
  
</head>
<body>
<div class="container-fluid mt-4">

  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-3 header">
    <h2>üë©‚Äç‚öïÔ∏è Manage Patients</h2>
    <a href="javascript:history.back()" class="back-button">
      <i class="bx bx-arrow-back"></i> Back
    </a>
  </div>

  <!-- Search -->
  <form method="GET" class="mb-3">
    <div class="input-group w-50">
      <input type="text" name="search" class="form-control" placeholder="Search by name, email, or username">
      <button type="submit" class="btn button-color">üîç Search</button>
    </div>
  </form>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
          {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
      {% endif %}
  {% endwith %}

  <!-- Patients Table -->
  <div class="table-responsive shadow-sm">
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-primary">
        <tr class="text-center">
            <th>Profile</th>
            <th><a href="?sort_by=id&order={{ 'desc' if sort_by=='id' and order=='asc' else 'asc' }}">ID</a></th>
            <th><a href="?sort_by=firstname&order={{ 'desc' if sort_by=='firstname' and order=='asc' else 'asc' }}">Full Name</a></th>
            <th>Username</th>
            <th><a href="?sort_by=email&order={{ 'desc' if sort_by=='email' and order=='asc' else 'asc' }}">Email</a></th>
            <th>Phone</th>
            <th class="dof-column">DOB</th>
            <th>Age</th>
            <th>ID NO</th>
            <th>Gender</th>
            <th>Marital Status</th>
            <th class="address-column">Address</th>
            <th>Blood Type</th>
            <th>Allergies</th>
            <th>Chronic Conditions</th>
            <th>Medical NO</th>
            <th>Emergency Name</th>
            <th>Relationship</th>
            <th>Emergency Contact</th>
            <th class="action-column">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for patient in patients %}
        <tr class="text-center">
          <td>
            {% if patient.profile_image %}
              <img src="{{ url_for('static', filename='uploads/' ~ patient.profile_image) }}" 
                   alt="Profile" class="rounded-circle" width="50">
            {% else %}
              <img src="{{ url_for('static', filename='images/default-avatar.png') }}" 
                   alt="Profile" class="rounded-circle" width="50">
            {% endif %}
          </td>
          <td>{{ patient.patient_id }}</td>
          <td>{{ patient.firstname }} {{ patient.lastname }}</td>
          <td>{{ patient.username }}</td>
          <td>{{ patient.email }}</td>
          <td>{{ patient.contact }}</td>
          <td class="dof-column">{{ patient.DateOfBirth }}</td>
          <td>{{ patient.age }}</td>
          <td>{{ patient.national_id}}</td>
          <td>{{ patient.gender }}</td>
          <td>{{ patient.marital_status }}</td>
          <td class="address-column">{{ patient.address }}</td>
          <td>{{ patient.blood_type }}</td>
          <td>{{ patient.allergies }}</td>
          <td>{{ patient.chronic_conditions }}</td>
          <td>{{ patient.medical_aid_number }}</td>
          <td>{{ patient.emergency_contact_name}}</td>
          <td>{{ patient.emergency_contact_relationship}}</td>
          <td>{{ patient.emergency_contact_phone}}</td>
          <td>
            <a href="#" class="btn btn-sm btn-warning">Edit</a>
            <form method="POST" action="{{ url_for('admin.delete_patient', patient_id=patient.patient_id) }}" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this patient?')">
                Delete
                </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
   <!-- Pagination -->
<nav aria-label="Page navigation" class="mt-3">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page-1 }}&search={{ search }}&sort_by={{ sort_by }}&order={{ order }}">Previous</a>
      </li>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}&search={{ search }}&sort_by={{ sort_by }}&order={{ order }}">{{ p }}</a>
      </li>
    {% endfor %}

    {% if page < total_pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page+1 }}&search={{ search }}&sort_by={{ sort_by }}&order={{ order }}">Next</a>
      </li>
    {% endif %}
  </ul>
</nav>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
